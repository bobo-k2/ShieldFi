<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShieldFi ‚Äî Pricing</title>
<meta name="description" content="ShieldFi pricing plans. Free wallet scanning, Guardian and Sentinel tiers for real-time monitoring and advanced AI analysis.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://shieldfi.app/pricing.html">
<meta property="og:title" content="ShieldFi ‚Äî Pricing Plans">
<meta property="og:description" content="Free wallet scanning. Upgrade for real-time monitoring, Telegram alerts, and advanced AI contract analysis.">
<meta property="og:image" content="https://shieldfi.app/logo.jpg">
<link rel="icon" type="image/jpeg" href="/logo.jpg">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0a0a0a;color:#e0e0e0;min-height:100vh;line-height:1.6}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);background-size:64px 64px;pointer-events:none;z-index:0}
.topnav{position:sticky;top:0;z-index:100;padding:.75rem 2rem;display:flex;justify-content:space-between;align-items:center;background:rgba(10,10,10,.9);backdrop-filter:blur(12px);border-bottom:1px solid rgba(255,255,255,.04)}
.nav-logo{font-size:1.15rem;font-weight:700;text-decoration:none;background:linear-gradient(135deg,#00d4aa,#7b61ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.nav-right{display:flex;align-items:center;gap:.75rem}
.btn{padding:10px 20px;background:linear-gradient(135deg,#00d4aa,#7b61ff);color:#000;font-weight:600;border:none;border-radius:8px;cursor:pointer;font-size:.9rem;transition:opacity .2s,transform .15s;display:inline-flex;align-items:center;gap:.4rem}
.btn:hover{opacity:.88;transform:translateY(-1px)}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none}
.btn-sm{padding:8px 16px;font-size:.85rem}
.btn-outline{background:transparent;border:1px solid #00d4aa;color:#00d4aa}
.btn-outline:hover{background:rgba(0,212,170,.08)}
.wallet-pill{font-family:monospace;font-size:.8rem;color:#888;background:#111118;border:1px solid #1a1a2e;padding:6px 12px;border-radius:20px}

.container{position:relative;z-index:1;max-width:1100px;margin:0 auto;padding:2rem 1.5rem}
.page-title{text-align:center;font-size:2rem;font-weight:800;margin-bottom:.5rem;background:linear-gradient(135deg,#00d4aa,#7b61ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.page-sub{text-align:center;color:#888;margin-bottom:2.5rem;font-size:1rem}

.plans{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.25rem;margin-bottom:2rem}
.plan-card{background:#111118;border:1px solid #1a1a2e;border-radius:16px;padding:2rem 1.5rem;display:flex;flex-direction:column;transition:border-color .3s,transform .2s}
.plan-card:hover{border-color:rgba(0,212,170,.3);transform:translateY(-2px)}
.plan-card.featured{border-color:#00d4aa;box-shadow:0 0 30px rgba(0,212,170,.1)}
.plan-card.featured .plan-badge{display:inline-block}
.plan-badge{display:none;background:linear-gradient(135deg,#00d4aa,#7b61ff);color:#000;font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:20px;margin-bottom:.75rem;align-self:flex-start;text-transform:uppercase;letter-spacing:.5px}
.plan-name{font-size:1.3rem;font-weight:700;margin-bottom:.25rem}
.plan-price{font-size:2rem;font-weight:800;margin-bottom:.25rem}
.plan-price span{font-size:.9rem;font-weight:400;color:#888}
.plan-desc{color:#888;font-size:.85rem;margin-bottom:1.25rem}
.plan-features{list-style:none;flex:1;margin-bottom:1.5rem}
.plan-features li{padding:.35rem 0;font-size:.85rem;color:#bbb;display:flex;align-items:center;gap:.5rem}
.plan-features li::before{content:'‚úì';color:#00d4aa;font-weight:700;font-size:.8rem}
.pay-buttons{display:flex;flex-direction:column;gap:.5rem}
.pay-btn{width:100%;padding:12px;border-radius:10px;font-weight:600;font-size:.9rem;cursor:pointer;border:none;transition:all .2s}
.pay-sol{background:linear-gradient(135deg,#00d4aa,#00b89c);color:#000}
.pay-usdc{background:transparent;border:1px solid #2775ca;color:#2775ca}
.pay-sol:hover{opacity:.9;transform:translateY(-1px)}
.pay-usdc:hover{background:rgba(39,117,202,.1)}
.pay-btn:disabled{opacity:.4;cursor:not-allowed;transform:none}

.status-msg{text-align:center;padding:1rem;border-radius:10px;margin-top:1rem;display:none}
.status-msg.success{display:block;background:rgba(0,212,170,.1);border:1px solid rgba(0,212,170,.3);color:#00d4aa}
.status-msg.error{display:block;background:rgba(255,68,68,.1);border:1px solid rgba(255,68,68,.3);color:#ff4444}
.status-msg.loading{display:block;background:rgba(123,97,255,.1);border:1px solid rgba(123,97,255,.3);color:#7b61ff}

@media(max-width:600px){.topnav{padding:.5rem .75rem}.plans{grid-template-columns:1fr}}
</style>
<script type="module">
import { Connection, PublicKey, Transaction, SystemProgram, TransactionInstruction } from 'https://esm.sh/@solana/web3.js@1.95.0';
window._solana = { Connection, PublicKey, Transaction, SystemProgram, TransactionInstruction };
window._solanaReady = true;
</script>
</head>
<body>

<nav class="topnav">
  <a href="/" class="nav-logo"><img src="/logo.jpg" alt="ShieldFi" style="height:44px;vertical-align:middle;border-radius:4px;margin-right:8px">ShieldFi</a>
  <div class="nav-right">
    <a href="/dashboard.html" class="btn btn-sm btn-outline">‚Üê Dashboard</a>
    <span class="wallet-pill" id="walletDisplay" style="display:none"></span>
    <button class="btn btn-sm" id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
  </div>
</nav>

<div class="container">
  <h1 class="page-title">Choose Your Shield</h1>
  <p class="page-sub">Protect your Solana wallets with real-time monitoring and alerts</p>

  <div class="plans">
    <!-- Free -->
    <div class="plan-card">
      <div class="plan-badge">Current</div>
      <div class="plan-name">Free</div>
      <div class="plan-price">$0 <span>/mo</span></div>
      <div class="plan-desc">Get started with basic protection</div>
      <ul class="plan-features">
        <li>Basic approval scanning</li>
        <li>1 wallet</li>
        <li>Manual scans only</li>
        <li>Community support</li>
      </ul>
      <a href="/dashboard.html" class="pay-btn pay-sol" style="text-align:center;text-decoration:none">Go to Dashboard</a>
    </div>

    <!-- Guardian -->
    <div class="plan-card featured" id="guardianCard">
      <div class="plan-badge">Most Popular</div>
      <div class="plan-name">üõ°Ô∏è Guardian</div>
      <div class="plan-price">$7 <span>/mo</span></div>
      <div class="plan-desc">0.04 SOL or 7 USDC</div>
      <ul class="plan-features">
        <li>Real-time approval monitoring</li>
        <li>Risk score analysis</li>
        <li>Email alerts</li>
        <li>Up to 5 wallets</li>
        <li>24h scan history</li>
      </ul>
      <div class="pay-buttons">
        <button class="pay-btn pay-sol" onclick="pay('guardian','sol')" id="guardianSolBtn">Pay 0.04 SOL</button>
        <button class="pay-btn pay-usdc" onclick="pay('guardian','usdc')" id="guardianUsdcBtn">Pay 7 USDC</button>
      </div>
    </div>

    <!-- Sentinel -->
    <div class="plan-card" id="sentinelCard">
      <div class="plan-badge">Pro</div>
      <div class="plan-name">‚öîÔ∏è Sentinel</div>
      <div class="plan-price">$19 <span>/mo</span></div>
      <div class="plan-desc">0.11 SOL or 19 USDC</div>
      <ul class="plan-features">
        <li>Everything in Guardian</li>
        <li>Unlimited wallets</li>
        <li>Telegram alerts</li>
        <li>Priority scanning</li>
        <li>Advanced risk breakdown</li>
        <li>API access</li>
      </ul>
      <div class="pay-buttons">
        <button class="pay-btn pay-sol" onclick="pay('sentinel','sol')" id="sentinelSolBtn">Pay 0.11 SOL</button>
        <button class="pay-btn pay-usdc" onclick="pay('sentinel','usdc')" id="sentinelUsdcBtn">Pay 19 USDC</button>
      </div>
    </div>
  </div>

  <div class="status-msg" id="statusMsg"></div>
</div>

<script>
const USDC_MINT = 'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v';
const PRICES = { guardian: { sol: 0.04, usdc: 7 }, sentinel: { sol: 0.11, usdc: 19 } };
let connectedWallet = null;
let treasury = '';

async function init() {
  const res = await fetch('/api/subscription/plans');
  const data = await res.json();
  treasury = data.treasury;

  // Auto-reconnect
  if (window.solana?.isPhantom && window.solana.isConnected) {
    try {
      const resp = await window.solana.connect({ onlyIfTrusted: true });
      setWallet(resp.publicKey.toString());
    } catch {}
  }
}

function setWallet(addr) {
  connectedWallet = addr;
  document.getElementById('walletDisplay').style.display = '';
  document.getElementById('walletDisplay').textContent = addr.slice(0,4) + '...' + addr.slice(-4);
  document.getElementById('connectBtn').style.display = 'none';
  checkStatus();
}

async function connectWallet() {
  if (!window.solana?.isPhantom) { alert('Please install Phantom wallet'); return; }
  try {
    const resp = await window.solana.connect();
    setWallet(resp.publicKey.toString());
  } catch (e) { console.error(e); }
}

async function checkStatus() {
  if (!connectedWallet) return;
  const res = await fetch('/api/subscription/status?wallet=' + connectedWallet);
  const data = await res.json();
  if (data.plan !== 'free') {
    showStatus('success', `You're on the ${data.plan.charAt(0).toUpperCase() + data.plan.slice(1)} plan! Expires: ${new Date(data.subscription.expiresAt).toLocaleDateString()}`);
  }
}

function showStatus(type, msg) {
  const el = document.getElementById('statusMsg');
  el.className = 'status-msg ' + type;
  el.textContent = msg;
}

async function pay(plan, currency) {
  if (!connectedWallet) { await connectWallet(); if (!connectedWallet) return; }
  if (!treasury) { showStatus('error', 'Treasury wallet not configured yet. Check back soon!'); return; }

  const btnId = plan + (currency === 'sol' ? 'Sol' : 'Usdc') + 'Btn';
  const btn = document.getElementById(btnId);
  btn.disabled = true;
  btn.textContent = 'Processing...';
  showStatus('loading', 'Preparing transaction...');

  try {
    // Wait for esm module to load
    if (!window._solanaReady) {
      await new Promise(r => { const i = setInterval(() => { if (window._solanaReady) { clearInterval(i); r(); } }, 50); });
    }
    const { Connection, PublicKey, Transaction, SystemProgram, TransactionInstruction } = window._solana;

    const connection = new Connection(window.location.origin + '/api/rpc');
    const fromPubkey = new PublicKey(connectedWallet);
    const toPubkey = new PublicKey(treasury);
    let tx;

    if (currency === 'sol') {
      const lamports = Math.round(PRICES[plan].sol * 1e9);
      tx = new Transaction().add(
        SystemProgram.transfer({ fromPubkey, toPubkey, lamports })
      );
    } else {
      // USDC SPL transfer (raw instructions, no spl-token dependency)
      const TOKEN_PROGRAM_ID = new PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA');
      const ASSOCIATED_TOKEN_PROGRAM_ID = new PublicKey('ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL');
      const usdcMint = new PublicKey(USDC_MINT);

      // Derive ATAs
      function findAta(owner, mint) {
        return PublicKey.findProgramAddressSync(
          [owner.toBuffer(), TOKEN_PROGRAM_ID.toBuffer(), mint.toBuffer()],
          ASSOCIATED_TOKEN_PROGRAM_ID
        )[0];
      }
      const fromAta = findAta(fromPubkey, usdcMint);
      const toAta = findAta(toPubkey, usdcMint);
      const amount = PRICES[plan].usdc * 1e6; // USDC has 6 decimals

      // Create ATA for treasury if needed + SPL transfer
      const createAtaIx = new TransactionInstruction({
        keys: [
          { pubkey: fromPubkey, isSigner: true, isWritable: true },
          { pubkey: toAta, isSigner: false, isWritable: true },
          { pubkey: toPubkey, isSigner: false, isWritable: false },
          { pubkey: usdcMint, isSigner: false, isWritable: false },
          { pubkey: SystemProgram.programId, isSigner: false, isWritable: false },
          { pubkey: TOKEN_PROGRAM_ID, isSigner: false, isWritable: false },
        ],
        programId: ASSOCIATED_TOKEN_PROGRAM_ID,
        data: Buffer.alloc(0),
      });

      // SPL Transfer instruction (instruction index 3)
      const transferData = Buffer.alloc(9);
      transferData.writeUInt8(3, 0); // Transfer instruction
      transferData.writeBigUInt64LE(BigInt(amount), 1);
      const transferIx = new TransactionInstruction({
        keys: [
          { pubkey: fromAta, isSigner: false, isWritable: true },
          { pubkey: toAta, isSigner: false, isWritable: true },
          { pubkey: fromPubkey, isSigner: true, isWritable: false },
        ],
        programId: TOKEN_PROGRAM_ID,
        data: transferData,
      });

      tx = new Transaction().add(createAtaIx, transferIx);
    }

    tx.feePayer = fromPubkey;
    tx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

    showStatus('loading', 'Please approve the transaction in your wallet...');
    const signed = await window.solana.signAndSendTransaction(tx);
    const signature = signed.signature;

    showStatus('loading', 'Confirming transaction...');
    // Wait a few seconds for TX to land, then verify server-side
    await new Promise(r => setTimeout(r, 5000));

    showStatus('loading', 'Verifying payment...');
    const verifyRes = await fetch('/api/subscription/verify', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ walletAddress: connectedWallet, txSignature: signature, plan }),
    });
    const result = await verifyRes.json();

    if (result.success) {
      showStatus('success', `üéâ Welcome to ${plan.charAt(0).toUpperCase() + plan.slice(1)}! Active until ${new Date(result.subscription.expiresAt).toLocaleDateString()}`);
      btn.textContent = '‚úì Subscribed!';
    } else {
      showStatus('error', result.error || 'Verification failed');
      btn.disabled = false;
      btn.textContent = currency === 'sol' ? `Pay ${PRICES[plan].sol} SOL` : `Pay ${PRICES[plan].usdc} USDC`;
    }
  } catch (err) {
    console.error(err);
    showStatus('error', err.message || 'Transaction failed');
    btn.disabled = false;
    btn.textContent = currency === 'sol' ? `Pay ${PRICES[plan].sol} SOL` : `Pay ${PRICES[plan].usdc} USDC`;
  }
}

init();
</script>
<!-- moved to head -->
</body>
</html>
